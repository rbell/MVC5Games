@model Games.Models.GameList

@{
    ViewBag.Title = "Rock Paper Scissors";
    ViewBag.Message = "Join or start a new Rock Paper Scissors game";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<hgroup>
    <h2>@ViewBag.Title.</h2>
    <h3>@ViewBag.Message</h3>
</hgroup>

<h4>Games Waiting for Another Player</h4>
<div class="dropdown clearfix">
    <ul id="activeGames" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" style="display: block; position: static; margin-bottom: 5px; *width: 180px;">
        @foreach (Tuple<string, string> game in Model)
        {
            <li><a tabindex="-1" href="/RockPaperScissors/JoinGame?id=@game.Item1">@game.Item2</a></li>
        }
    </ul>
</div>
<button id="newGameButton" class="btn btn-primary">New Game</button>

@section scripts{
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.0-rc1.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script type="text/javascript">
        $(function () {
            $('#newGameButton').click(function () {
                var name = prompt('Enter name for the new game:', '');
                window.location.href = "/RockPaperScissors/JoinGame?name=" + name;
            });

            // Declare a proxy to reference the hub.
            var rockPaperScissors = $.connection.rockPaperScissorsHub;
            // Create a function that the hub can call to broadcast messages.
            rockPaperScissors.client.newGame = function (id, name) {
                // Html encode display name and message.
                var encodedText = $('<div />').text(name).html();
                // Add the message to the page.
                $('#activeGames').append('<li><a tabindex="-1" href="/RockPaperScissors/JoinGame?id=' + id + '">' + encodedText + '</a></li>');
            };
            
            rockPaperScissors.client.endGame = function (id) {
                var select = 'li:has(a[href$=' + id + '])';
                $('#activeGames').children().remove(select);
            }

            $.connection.hub.start();
        });
    </script>
}
